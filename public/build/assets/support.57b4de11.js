import{_,h as x,i as v,V as $,j as h,o as d,c as r,a as e,b as p,w as l,v as n,e as m,t as i,d as y,F as f,k as j,q as C,u as L,r as k,l as g,m as T}from"./app.c6c6a3cb.js";const V={emits:["loadingHide","loading"],props:{loading:Boolean,user:Object},components:{"header-admin":x(()=>v(()=>import("./header-admin.6f180bbb.js"),["assets/header-admin.6f180bbb.js","assets/app.c6c6a3cb.js","assets/app.c39a63c1.css"])),VueGoodTable:$},data(){return{loading:!0,editLoad:!1,successState:!1,answer:{text:"",file:"",status:"answered"},columns:[{label:this.$t("name"),field:"user"},{label:this.$t("subject"),field:"subject"},{label:this.$t("status"),field:"status"},{label:this.$t("last-update"),field:"time"},{label:this.$t("the-operation"),field:"after"}],tickets:[],ticket:{id:"",subject:"",status:"",user:"",userId:"",text:"",time:"",file:"",dialog:[]}}},methods:{onChangeDoc(){this.answer.file=this.$refs.document.files[0]},updateTicket(){this.editLoad=!1;let t=new FormData;t.append("api_token",this.$cookies.get("user").token),t.append("userid",parseInt(this.$cookies.get("user").id)),t.append("text",this.answer.text),t.append("status",this.answer.status),t.append("ticket",this.ticket.id),t.append("file",this.answer.file),t.append("type","admin"),h.post("/ticket/update",t,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{s.data=="success"&&(this.answer.text="",this.answer.file="",this.answer.status="answered",this.ticket.id="",this.ticket.subject="",this.ticket.status="",this.ticket.user="",this.ticket.userId="",this.ticket.text="",this.ticket.time="",this.ticket.file="",this.ticket.dialog=[],this.$refs.toggleButton.click(),this.getAll())}).catch(()=>{this.$emit("loadingHide")}),this.editLoad=!1},getTicket(t){this.editLoad=!1,this.$refs.editModal.click(),h.get("/ticket/single/"+t,{params:{api_token:this.$cookies.get("user").token,language:"fa"}}).then(s=>{this.ticket.id=s.data.id,this.ticket.subject=s.data.subject,this.ticket.status=s.data.status,this.ticket.user=s.data.user,this.ticket.userId=s.data.userId,this.ticket.text=s.data.text,this.ticket.time=s.data.time,this.ticket.file=s.data.file!=null?this.$hostname+"upload/support/"+s.data.file:null,this.ticket.dialog=s.data.dialog,this.$emit("loadingHide")}).catch(()=>{this.$emit("loadingHide")})},getAll(){this.tickets=[],h.get("/ticket",{params:{api_token:this.$cookies.get("user").token}}).then(t=>{for(const s of t.data)this.tickets.push({id:s.id,user:s.user,subject:s.subject,status:s.status,time:s.time});this.$emit("loadingHide")}).catch(()=>{this.$emit("loadingHide")})}},beforeCreate(){h.get("/ticket",{params:{api_token:this.$cookies.get("user").token}}).then(t=>{for(const s of t.data)this.tickets.push({id:s.id,user:s.user,subject:s.subject,status:s.status,time:s.time});this.$emit("loadingHide")}).catch(()=>{this.$emit("loadingHide")})},watch:{$route:{immediate:!0,handler(t,s){document.title=this.$t("support")+" | "+this.$t("adminTitlePage")}}}},D={class:"content"},H={class:"alert alert-outline-danger alert-dismissible show flex items-center col-span-12 bg-white mt-2 font-bold",role:"alert"},E=e("i",{"data-feather":"alert-octagon",class:"w-6 h-6 ml-2"},null,-1),I={class:"box intro-y"},M={key:0},P={key:1},B=["onClick"],A={href:"javascript:;","data-toggle":"modal",ref:"editModal","data-target":"#modaledit",class:"d-none"},N={id:"modaledit",class:"modal",tabindex:"-1"},S={class:"modal-dialog"},F={class:"modal-content"},O={class:"modal-header"},U={class:"font-medium text-left ml-auto"},q={class:"modal-body grid grid-cols-12 gap-4 gap-y-3"},G={class:"col-span-12 sm:col-span-12"},R=["href"],z={class:"bg-light-2 p-2 rounded mt-2"},J=e("br",null,null,-1),K=["href"],Q={class:"col-span-12 sm:col-span-12"},W={value:"check"},X={value:"process"},Y={value:"answered"},Z={value:"new"},tt={class:"btn btn-light w-20"},et={for:"document",class:"cursor-pointer"},st={class:"modal-footer justify-end flex items-center"},it=e("i",{"data-loading-icon":"puff",class:"w-5"},null,-1),at=[it];function ot(t,s,c,lt,o,u){const b=k("header-admin"),w=k("vue-good-table");return d(),r(f,null,[e("div",D,[p(b,{user:c.user,title:t.$t("support")},null,8,["user","title"]),l(e("div",H,[E,m(" "+i(t.$t("access-message")),1)],512),[[n,!c.user.role.support.show]]),l(e("div",I,[p(w,{class:"p-2",columns:o.columns,rows:o.tickets,rtl:!0,theme:"polar-bear","line-numbers":!0,"fixed-header":!0,"pagination-options":{enabled:!0,mode:"records",perPage:10,nextLabel:t.$t("next"),prevLabel:t.$t("prev"),rowsPerPageLabel:"",ofLabel:t.$t("of"),allLabel:t.$t("all")},"search-options":{enabled:!0,placeholder:t.$t("search")}},{"table-row":y(a=>[a.column.field=="status"?(d(),r("div",M,[l(e("span",{class:"my-1 px-2 mx-1 rounded-full text-xs bg-theme-21 text-white"},i(t.$t("new")+" "),513),[[n,a.row.status=="new"]]),l(e("span",{class:"my-1 px-2 mx-1 rounded-full text-xs bg-theme-20 text-white"},i(t.$t("answered")+" "),513),[[n,a.row.status=="answered"]]),l(e("span",{class:"my-1 px-2 mx-1 rounded-full text-xs bg-theme-1 text-white"},i(t.$t("process")+" "),513),[[n,a.row.status=="process"]]),l(e("span",{class:"my-1 px-2 mx-1 rounded-full text-xs bg-theme-1 text-white"},i(t.$t("check")+" "),513),[[n,a.row.status=="check"]])])):g("",!0),a.column.field=="after"?(d(),r("span",P,[l(e("button",{onClick:T(nt=>u.getTicket(a.row.id),["prevent"]),class:"btn btn-sm btn-outline-dark m-1 font-bold"},i(t.$t("management")),9,B),[[n,c.user.role.support.edit]])])):g("",!0)]),_:1},8,["columns","rows","pagination-options","search-options"])],512),[[n,c.user.role.support.show]])]),e("a",A,null,512),e("div",N,[e("div",S,[e("div",F,[e("div",O,[e("h2",U,i(t.$t("answer")+" "+o.ticket.subject),1)]),e("div",q,[e("div",G,[e("p",null,i(t.$t("last-update"))+" : "+i(o.ticket.time),1),e("p",null,i(t.$t("name"))+" : "+i(o.ticket.user),1),e("p",null,[m(i(t.$t("status"))+" : ",1),l(e("span",{class:"my-1 px-2 mx-1 rounded-full text-xs bg-theme-21 text-white"},i(t.$t("new")+" "),513),[[n,o.ticket.status=="new"]]),l(e("span",{class:"my-1 px-2 mx-1 rounded-full text-xs bg-theme-20 text-white"},i(t.$t("answered")+" "),513),[[n,o.ticket.status=="answered"]]),l(e("span",{class:"my-1 px-2 mx-1 rounded-full text-xs bg-theme-1 text-white"},i(t.$t("process")+" "),513),[[n,o.ticket.status=="process"]]),l(e("span",{class:"my-1 px-2 mx-1 rounded-full text-xs bg-theme-1 text-white"},i(t.$t("check")+" "),513),[[n,o.ticket.status=="check"]])]),e("p",null,i(t.$t("text"))+" : "+i(o.ticket.text),1),l(e("a",{href:o.ticket.file},i(t.$t("file")),9,R),[[n,o.ticket.file]]),(d(!0),r(f,null,j(o.ticket.dialog,a=>(d(),r("div",z,[m(i(a.text)+" ",1),J,e("small",null,[m(i(a.time)+" - "+i(a.user)+" - ",1),l(e("a",{href:this.$hostname+"upload/support/"+a.file},i(t.$t("file")),9,K),[[n,a.file]])])]))),256))]),e("div",Q,[l(e("textarea",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=a=>o.answer.text=a)},`\r
                        `,512),[[C,o.answer.text]]),l(e("select",{"onUpdate:modelValue":s[1]||(s[1]=a=>o.answer.status=a),class:"form-control"},[e("option",W,i(t.$t("check")),1),e("option",X,i(t.$t("process")),1),e("option",Y,i(t.$t("answered")),1),e("option",Z,i(t.$t("new")),1)],512),[[L,o.answer.status]])]),e("input",{id:"document",ref:"document",type:"file",style:{display:"none"},onChange:s[2]||(s[2]=(...a)=>u.onChangeDoc&&u.onChangeDoc(...a))},null,544),e("button",tt,[e("label",et,i(t.$t("upload")),1)])]),e("div",st,[e("button",{ref:"closeEditModal",onClick:s[3]||(s[3]=a=>{o.answer.text=""}),type:"button","data-dismiss":"modal",class:"btn btn-outline-secondary w-20 mx-4"},i(t.$t("cancel")),513),e("button",{type:"button",onClick:s[4]||(s[4]=a=>u.updateTicket()),class:"btn btn-success w-20"},[l(e("div",null,i(t.$t("answer")),513),[[n,!o.editLoad]]),l(e("div",null,at,512),[[n,o.editLoad]])])])])])])],64)}const rt=_(V,[["render",ot]]);export{rt as default};
